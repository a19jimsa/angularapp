#version 300 es
precision mediump float;
layout(location = 0) in vec4 a_position;
layout(location = 1) in vec2 a_texcoord;
layout(location = 2) in vec3 a_normal;

uniform mat4 u_matrix;
uniform mat4 u_model;
uniform float u_time;
uniform float u_displacmentScale;
uniform float u_tiling;
uniform float u_flowSpeed;
uniform sampler2D u_texture;
uniform vec3 u_cameraPos;

out vec2 v_texcoord;
out vec3 v_normal;
out vec3 v_fragPos;

void main() {
   vec2 tileSize = vec2(1.0 / 3.0, 1.0 / 1.0);
   vec2 uv_heightMap = fract(a_texcoord + vec2(0.0, -1.0) * u_time * 0.01) * (tileSize) + vec2(1.0, 0.0) * tileSize;
   float displacementScale = u_displacmentScale;
   float displacement = texture(u_texture, uv_heightMap).r * displacementScale;
   vec4 displacedPosition = a_position + vec4(0, displacement, 0, 0);
   gl_Position = u_matrix * u_model * displacedPosition;
   v_texcoord = a_texcoord;
   v_normal = a_normal;
   vec4 worldPosition = u_model * a_position;
   v_fragPos = worldPosition.xyz;
}