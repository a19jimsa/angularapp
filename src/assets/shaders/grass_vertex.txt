precision mediump float;

attribute vec3 a_position;
attribute vec2 a_texcoord;
attribute vec3 a_normal;
attribute vec3 a_instancePositions;

uniform mat4 u_matrix;
uniform float u_time;
uniform sampler2D u_texture;

varying vec2 v_texcoord;
varying float v_height;
varying vec3 v_instancePositions;

void main() {
    float noise = texture2D(u_texture, a_instancePositions.xz).r;
    float sway = sin(u_time + (a_instancePositions.x + noise) * 0.1) * a_position.y / 2.0;
    vec3 displaced = a_position;
    displaced.x += sway;
    v_height = a_position.y;
    v_texcoord = a_texcoord;
    v_instancePositions = a_instancePositions;
    gl_Position = u_matrix * (vec4(displaced, 1.0) + vec4(a_instancePositions, 1.0));
}